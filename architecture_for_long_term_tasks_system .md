# Простая архитектура для систем обработки задач занимающих длительное время

## Аннотация
В статье, на примере системы трансляции документации из HTML в PDF, рассматривается архитектура подходящая для реализации систем выполняющих длительные операции по запросу клиента. Рассматриваемая архитектура удобна для горизонтального масштабирования, а так же устойчива к сбоям.


## Введение
Когда компьютеры были большими, а их проникновение в сферы человеческой деятельности ограничивались научными и банковскими расчетами, взаимодействие с вычислительными машинами представляла собой, в основном, пакетную обработку задач. Ученый, желающий провести численные расчеты на ЭВМ института, писал программу, резервировал время в вычислительном центре, приходил, запускал свою программу и ждал ответа. Ждать, порой, приходилось долго.  
Те времена давно прошли, и сегодня нам, даже в смартфоне, доступны вычислительные ресурсы сравнимые, а порой и превосходящие те, что были пределом мечтаний в 70х-80х гг.   
Но с ростом вычислительной мощности расли и аппетиты: Сегодня компьтеры проникли во все сферы жизни. Данных, требующих обработки, становится все больше, алгоритмы обработки становятся все сложнее, а понятие долго, в некоторых областях, сократилось до "нескольких минут". И если в науке и сегодня считается нормальным заказывать время для вычислений на суперкомпьютере, и ожидать ответа несколько часов, то в других сферах деятельности это выглядит как минимум странно.  

Наиболее ярко это проявляется в корпоративных информационных системах.  

Среди всего многообразия задач, с которыми сталкиваются программисты при разработке корпоративных систем, можно выделить подкласс, который описать как "выстрелил-забыл-по завершению получил уведомление". К такому классу задач, к примеру, можно отнести задачи построения больших отчетов, построение аналитики по сложным и/или большим выборкам, выполение преобразования данных одного формата в другой, и т.д. Все приведенные примеры объединяются по нескольким признакам: Во-первых, все эти задачи стартуют по запросу пользователя. Во-вторых, они являются длительными. И, наконец, третий признак: пользователь хочет иметь возможность проверять статус задачи, а еще лучше, если по завершению вычислений пользователь получить уведомление с результатами.  
К подсистемам, решающие такого рода задачи, чаще всего предъявляются следующие требования: 
* подсистема не должна заставлять пользователя останавливать свою работу в ожидании результатов вычислений - оператор, запустивший построение отчета, не должен все время, пока отчет строится, смотреть в монитор на прогрессбар;
* подсистема должна уметь обрабатывать ошибки и сбои, востанавливаться после них и продолжать вычисления - пользователь будет негативно относится к системе, если вычисления, занимающие в среднем три часа, вдруг, через два часа, завершаться аварийно, в следствии превышения таймаута доступа к базе;  
* подсистема должна быть горизонтально масштабируемой - в случае, если число операторов увеличиться, или одному оператору будет нужно запускать больше вычислений, должна быть возможность достаточно просто увеличить производительность системы.   
 
Наиболее распространненным и интуитивно понятным решением для таких систем является разбиение всего процесса вычислений на стадии, а переходы между стадиями осуществлять на основе сообщений и очередий.   
Далее, на примере подсистемы преобразования документации из html в pdf будет показана достаточно простое архитектурное решение для такой подсистемы.  

## Общее описание задачи

Любая компания, производящая выскотехнологичный продукт, будь то ПО или станки, должна вести подробную документацию на свою продукцию. Документация, и разного рода соглашения, обеспечивают, кроме прочего, юридическую защиту компании.   
Предположим, что некая компания ведет документацию в формате HTML. Это может быть хорошим решением, если, изначально, стояла задача предоставить удобный и простой способ доступа к документации для клиентов.  
Для формироания, ведения и публикации документации IT отдел компании разработал внутреннюю систему. Через некоторое время, юредический отдел запросил предоставить им возможность преобразования документации из формата HTML в формат PDF. При этом, подразумивается осуществлять перевод в PDF не всей имеющуюся документацию, а лишь проивозольного ее подмножества: определенные главы/пункты/подпункты.  
Допустим, что документация довольно объемна, и зависит, как от самого продукта, так и от его версии/модификации.   

## Описание в виде Use Case

**_Цель:_** Преобразование определенного подмножества документации по продукту из HTML формата в формат PDF.  
**_Акторы:_** Уполномоченный оператор юредического отдела.  
**_Интересанты_**: Ответственные сотрудники юр. отдела.    
**_Предворительные условия:_** Во внутренней системе сформированна полная документация на продукт указанной версии/модификации в формате HTML.   
**_Активаторы:_** Запрос юридического отдела на формирования определенного подмножества документации на продукт в виде PDF-файла.  
**_Порядок событий:_**  
1. Уполномоченный оператор заходит во внутреннию систему и проверяет статус формирования документации для заданного продукта версии/модификации;  
2. Если у документации стоит статус "сформирована";  
3. Оператор переходит в оглавление документации и переводит его в режим "выбора разделов для трансляции", при этом у каждого пункта оглавления появляется чекбокс, а слева от оглавления появляется кнопка "Транслировать в PDF";  
4. Проставляя галочки в чекбоксах, оператор выбирает необходимые пункты документации;  
5. По завершению выбора, оператор нажымает на кнопку "Транслировать в PDF"; 
6. Система преобразует, выбранные пользователем, разделы документации в PDF;  
7. Система оповещает заинтересованных лиц об окончании формирования PDF;
_Альтернативные сценарии опущены._
 
## Архитектура системы
